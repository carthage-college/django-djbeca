{% extends "base.html" %}
{% load ifusergroup %}
{% load humanize %}
{% block extra_javascript %}
<script src="//www.carthage.edu/static/vendor/js/spin.min.js"
    type="text/javascript"></script>
<script src="https://malsup.github.io/min/jquery.blockUI.min.js"
    type="text/javascript"></script>
<script type="text/javascript">
$(function() {
  /* spinner */
  var opts = {
      lines: 13, // The number of lines to draw
      length: 20, // The length of each line
      width: 10, // The line thickness
      radius: 30, // The radius of the inner circle
      corners: 1, // Corner roundness (0..1)
      rotate: 0, // The rotation offset
      direction: 1, // 1: clockwise, -1: counterclockwise
      color: '#000', // #rgb or #rrggbb or array of colors
      speed: 1, // Rounds per second
      trail: 60, // Afterglow percentage
      shadow: false, // Whether to render a shadow
      hwaccel: false, // Whether to use hardware acceleration
      className: 'search-results', // The CSS class to assign to spinner
      zIndex: 2e9, // The z-index (defaults to 2000000000)
      top: '50px', // Top position relative to parent in px
      left: 'auto' // Left position relative to parent in px
  };
  var target = document.getElementById("wrapper");
  var spinner = new Spinner(opts).spin(target);
  spinner.stop(target);

  $(".proposal-status").click(function () {
    $.ajax({
      type: "POST",
      url: "{% url 'proposal_status' proposal.id %}",
      data: {'status':$(this).data('status')},
      cache: false,
      beforeSend: function(){
        spinner.spin(target);
      },
      success: function(data) {
        spinner.stop(target);
        $.growlUI(data);
      },
      error: function(data) {
        spinner.stop(target);
        $.growlUI('Error', data);
      }
    });
    //$.growlUI('Test', 'status: ' + $(this).data('status'));
  });
});
</script>
{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">
      Proposal Detail
      <a href="#" id="print" class="no-print-icon">
        <i class="fa fa-print green" aria-hidden="true"
          title="Print to paper or PDF"></i></a>
      {% ifusergroup 'Sponsored Programs' %}|
      <a href="{% url 'proposal_approver' proposal.id %}"
        class="no-print-icon">
        <i class="fa fa-thumbs-o-up green" aria-hidden="true"
          title="Add Approver to this proposal"></i></a> |
      <a href="{% url 'email_investigator_form' proposal.id 'email' %}"
        class="no-print-icon">
        <i class="fa fa-envelope green" aria-hidden="true"
          title="Send Email to {{proposal.user.first_name}} {{proposal.user.last_name}}"></i></a>
      {% endifusergroup %}
    </h1>
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{% if perms.approve %}
{% if not proposal.step1 or not proposal.step2 %}
<div class="row">
  <div class="col-lg-12 text-center">
    <div class="panel panel-default">
      <div class="panel-body">
        <a href="#" class="btn btn-default btn-success proposal-status"
          style="width:128px;" data-status="approve">Approve</a>
        <a href="#" class="btn btn-default btn-danger proposal-status"
          style="margin-left:24px;width:128px;" data-status="decline">Decline</a>
      </div>
    </div>
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{% endif %}{% endif %}
<div class="row">
  {% if proposal.proposal_impact %}
  <div class="col-lg-6">
  {% else %}
  <div class="col-lg-8">
  {% endif %}
    <div class="panel panel-default">
      <div class="panel-body">
        <h2>
          Part A
          {% if request.user.id == proposal.user.id %}
          <a href="{% url 'proposal_update' proposal.id %}"
            class="no-print-icon" style="float:right;color:#fff">
            <i class="fa fa-pencil" aria-hidden="true"
              title="Update Part A"></i></a>
          {% endif %}
        </h2>
        <h3 class="detail">
          Basic Proposal Elements
        </h3>
        <h4>What type of proposal submission is this?</h4>
        <h5>{{proposal.proposal_type}}</h5>
        {% if proposal.proposal_type_other %}
        <h4>If 'Other', please provide details</h4>
        <h5>{{proposal.proposal_type_other}}</h5>
        {% endif %}
        <h4>Funding Agency Name and Grant Program Name</h4>
        <h5>{{proposal.funding_agency_program_name}}</h5>
        <h4>What type of funding source is the granting agency?</h4>
        <h5>{{proposal.grant_agency_funding_source}}</h5>
        {% if proposal.grant_agency_funding_other %}
        <h4>If 'Other', please provide details</h4>
        <h5>{{proposal.grant_agency_funding_other}}</h5>
        {% endif %}
        <h4>Solicitation Website</h4>
        <h5>
          <a href="{{proposal.grant_agency_url}}">
            {{proposal.grant_agency_url}}
          </a>
        </h5>
        <h4>Proposal Deadline Date/Time</h4>
        <h5>
          {{proposal.grant_deadline_date}}
          {{proposal.grant_deadline_time}}
        </h5>
        <h3 class="clear detail">
          Investigator Information
        </h3>
        <dl class="clear dl-horizontal">
          <dt>Author</dt>
          <dd>
            <a href="mailto:{{proposal.user.email}}">
              {{proposal.user.last_name}},
              {{proposal.user.first_name}}
            </a>
          </dd>
          <dt>Department</dt>
          <dd>
            {{proposal.department}}
          </dd>
        </dl>
        <h4>Are other institutions involved?</h4>
        <h5>{{proposal.partner_institutions}}</h5>
        {% if proposal.partner_institutions == 'Yes' %}
          <h4>All Institutions Involved</h4>
          <ul>
          {% for inst in institutions %}
            {% if inst.institution %}
            <li>{{inst.institution}}</li>
            {% endif %}
          {% endfor %}
          </ul>
        {% endif %}
        <h4>
          Is Carthage College the lead institution on this project?
        </h4>
        <h5>{{proposal.lead_institution}}</h5>
        {% if proposal.lead_institution == 'No' %}
          <h4>Lead Institution Name</h4>
          <h5>{{proposal.lead_institution_name}}</h5>
          <h4>Lead Institution Contact</h4>
          <div>
            {{proposal.lead_institution_contact}}
          </div>
        {% endif %}
      <h4>
        Co-Principal Investigators & Associated Institution
      </h4>
      <ul>
        {% for cp in co_principals %}
          {% if cp.name and cp.institution %}
          <li>{{cp.name}}&mdash;{{cp.institution}}</li>
          {% endif %}
        {% endfor %}
      </ul>
      <h3 class="clear detail">
        Project Overview
      </h3>
        <h4>Title</h4>
        <h5>{{proposal.title}}</h5>
        <h4>
          Dates
        </h4>
        <dl class="clear dl-horizontal">
          <dt>Start Date</dt>
          <dd>{{proposal.start_date}}</dd>
          <dt>End date</dt>
          <dd>{{proposal.end_date}}</dd>
        </dl>
        <h4>
          Project Type
        </h4>
        <h5>
          {{proposal.project_type}}
        </h5>
        <h4>
          Summary
        </h4>
        <div>{{proposal.summary}}</div>
        <h4>
          Is this one year funding or multi-year?
        </h4>
        <h5>
          {{proposal.time_frame}}
        </h5>
        <h4>
          Total Budget Request
        </h4>
        <h5>
          ${{proposal.budget_total|intcomma}}
        </h5>
        <h4>
          Budget Summary
        </h4>
        <div>{{proposal.budget_summary}}</div>
        <!-- fin -->
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  {% if proposal.proposal_impact %}
  <!-- /.col-lg-6 -->
  <div class="col-lg-6">
    <div class="panel panel-default">
      <div class="panel-body">
        <h2>
          Part B
          {% if request.user.id == proposal.user.id %}
          <a href="{% url 'impact_form' proposal.id %}"
            class="no-print-icon" style="float:right;color:#fff">
            <i class="fa fa-pencil" aria-hidden="true"
              title="Update Part B"></i></a>
          {% endif %}
        </h2>
        <h3 class="detail">
          Budget Data
        </h3>
        <div>
          <h4>Total budget request</h4>
          <h5>${{proposal.proposal_budget.total|intcomma}}</h5>
          <h4>Total Cost Share / Match Amount</h4>
          <h5>
            {% if proposal.proposal_budget.cost_match_amount %}
            ${{proposal.proposal_budget.cost_match_amount|intcomma}}
            {% else %}
             0
            {% endif %}
          </h5>
          <h4>What is Indirect Cost Rate Used?</h4>
          <h5>{{proposal.proposal_budget.indirect_cost_rate}}</h5>
          {% if proposal.proposal_budget.indirect_cost_rate == 'Other' %}
          <h4>If 'Other', please specify the rate</h4>
          {% endif %}
          <h5>{{proposal.proposal_budget.indirect_cost_rate_other}}</h5>
          <h4>Final Budget for Review</h4>
          <h5>
            {% if proposal.proposal_budget.budget_final %}
            <a href="https://{{server_url}}{{media_url}}/{{proposal.proposal_budget.budget_final}}">
            https://{{server_url}}{{media_url}}/{{proposal.proposal_budget.budget_final}}</a>
            {% else %}
            Missing
            {% endif %}
          </h5>
          <h4>Final Budget Justification for Review</h4>
          <h5>
            {% if proposal.proposal_budget.budget_justification_final %}
            <a href="https://{{server_url}}{{media_url}}/{{proposal.proposal_budget.budget_justification_final}}">
            https://{{server_url}}{{media_url}}/{{proposal.proposal_budget.budget_justification_final}}</a>
            {% else %}
            Missing
            {% endif %}
          </h5>
        </div>
        <h3 class="detail">
          Institutional Impacts
        </h3>
        <div>
          <h4>Does this proposal require course release or overload?</h4>
          <h5>{{proposal.proposal_impact.course_release}}</h5>
          <h4>Does this proposal require additional pay?</h4>
          <h5>{{proposal.proposal_impact.additional_pay}}</h5>
          <h4>Does this proposal require payout to Carthage students?</h4>
          <h5>{{proposal.proposal_impact.payout_students}}</h5>
          <h4>
            Does this proposal require the creation of new Carthage positions?
          </h4>
          <h5>{{proposal.proposal_impact.new_positions}}</h5>
          <h4>
            Does this proposal result in the purchase of major equipment,
            costing over $5,000?
          </h4>
          <h5>{{proposal.proposal_impact.purchase_equipment}}</h5>
          <h4>
            Does this proposal require additional office,
            lab or other facilities or room modifications?
          </h4>
          <h5>{{proposal.proposal_impact.infrastructure_modifications}}</h5>
          <h4>Does this proposal require review of IRB and/or IACUC?</h4>
          <h5>{{proposal.proposal_impact.institutional_review}}</h5>
          {% if proposal.proposal_impact.institutional_review == 'Yes' %}
          <h4>If 'Yes', please provide the approval date</h4>
          <h5>{{proposal.proposal_impact.institutional_review_date}}</h5>
          {% endif %}
          <h4>Does this proposal require cost share/match?</h4>
          <h5>{{proposal.proposal_impact.cost_share_match}}</h5>
          <h4>Does this proposal contain any voluntary commitment?</h4>
          <h5>{{proposal.proposal_impact.voluntary_committment}}</h5>
        </div>
        <h3 class="detail">
          Project Goals
        </h3>
        {% for g in proposal.proposal_goal.all %}
          <h4>{{g.name}}</h4>
          <p>{{g.description}}</p>
        {% endfor %}
        </dl>
        <h3 class="detail">
          Additional Information
        </h3>
        {% if proposal.comments %}
          <h4>Comments</h4>
          <h5>{{proposal.comments}}</h5>
        {% endif %}


        <h3 class="detail">
          Additional Documents
        </h3>
        <ul>
        {% for d in proposal.proposal_documents.all %}
          <li>
            <a href="{{d.phile}}">{{d.name}}</a>
          </li>
        {% endfor %}
        </ul>



        <!-- fin -->
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-6 -->
  {% endif %}
</div>
<!-- /.row -->
{% endblock content %}
