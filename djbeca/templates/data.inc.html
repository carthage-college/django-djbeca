{% load ifusergroup %}
<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover display proposals-data">
    <thead>
      <tr>
        <th>
          Title
          <i class="fa fa-eye green blue-tooltip" data-toggle="tooltip"
            data-placement="top" aria-hidden="true"
            title="View Proposal"></i>
          /
          <i class="fa fa-print green blue-tooltip" data-toggle="tooltip"
            data-placement="top" aria-hidden="true"
            title="Print Proposal"></i></a>
        </th>
        <th>Part A</th>
        <th>Part B</th>
        <th>
          Submitted by
          {% ifusergroup osp_group %}
          <i class="fa fa-envelope-o green blue-tooltip" data-toggle="tooltip"
            data-placement="top" aria-hidden="true"
            title="Send email to primary investigator"></i>
          {% endifusergroup %}
        </th>
        <th>Deadline Date</th>
      </tr>
    </thead>
    <tbody>
      {% for p in proposals %}
        <tr>
          <td>
            <a href="{% url 'proposal_detail' p.id %}" data-toggle="tooltip"
            data-placement="top" class="blue-tooltip"
            title="View Proposal">{{p.title}}</a>
          </td>
          {% if not p.decline %}
          <td>
            {% if p.step1 or group or request.user.is_superuser %}
              {% if p.user.id == request.user.id or group or request.user.is_superuser %}
                {% if not p.save_submit %}
                <a href="{% url 'proposal_update' p.id %}" data-toggle="tooltip"
                data-placement="top" title="Update Part A" class="blue-tooltip">
                  <i class="fa fa-2x fa-pencil-square-o" aria-hidden="true"></i>
                </a>
                {% endif %}
              {% endif %}
            {% else %}
              <i class="fa fa-2x fa-exclamation-circle yellow blue-tooltip"
              data-toggle="tooltip" data-placement="top" aria-hidden='true'
              title="Part A has not been Approved"></i>
            {% endif %}
            {% for a in p.proposal_approvers.all %}
              {% if a.replace != 'level3' %}
                {% if a.step1 %}
                  <i class="fa fa-2x fa-check green blue-tooltip"
                  data-toggle="tooltip" data-placement="top" aria-hidden="true"
                  title="{{a.user.last_name}}, {{a.user.first_name}} Approved"></i>
                {% else %}
                  <i class="fa fa-2x fa-times red blue-tooltip"
                  data-toggle="tooltip" data-placement="top" aria-hidden="true"
                  title="{{a.user.last_name}}, {{a.user.first_name}} has NOT Approved this proposl"></i>
                {% endif %}
              {% endif %}
            {% endfor %}
            {% if p.level3 %}
              <i class="fa fa-2x fa-check green blue-tooltip"
              data-toggle="tooltip" data-placement="top" aria-hidden="true"
              title="Division Dean or VP has approved Part A"></i>
            {% else %}
              <i class="fa fa-2x fa-times red blue-tooltip"
              data-toggle="tooltip" data-placement="top" aria-hidden="true"
              title="Division Dean or VP has NOT approved Part A"></i>
            {% endif %}
          </td>
          <td>
            {% if p.step1 %}
              {% if p.user.id == request.user.id or group or request.user.is_superuser %}
                {% if not p.save_submit %}
                <a href="{% url 'impact_form' p.id %}"
                data-toggle="tooltip" data-placement="top" class="blue-tooltip"
                title="Update Part B">
                  <i class="fa fa-2x fa-pencil-square-o" aria-hidden="true"></i>
                </a>
                {% endif %}
              {% endif %}
            {% else %}
              <i class="fa fa-2x fa-exclamation-circle yellow blue-tooltip"
              data-toggle="tooltip" data-placement="top" aria-hidden='true'
              title="Part A must be approved before proceeding to Part B"></i>
            {% endif %}
            {% for a in p.proposal_approvers.all %}
              {% if a.replace != 'level3' %}
                {% if a.step2 %}
                <i class="fa fa-2x fa-check green blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="{{a.user.last_name}}, {{a.user.first_name}} Approved"></i>
                {% else %}
                <i class="fa fa-2x fa-times red blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="{{a.user.last_name}}, {{a.user.first_name}} has NOT Approved Part B"></i>
                {% endif %}
              {% endif %}
            {% endfor %}
            {% if p.proposal_impact.level3 %}
                <i class="fa fa-2x fa-check green blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="Division Dean or Department VP Approved"></i>
            {% else %}
                <i class="fa fa-2x fa-times red blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="Dean or Department VP has NOT approved Part B"></i>
            {% endif %}
            {% if p.proposal_impact.level2 %}
                <i class="fa fa-2x fa-check green blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="CFO Approved"></i>
            {% else %}
                <i class="fa fa-2x fa-times red blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="CFO has NOT approved Part B"></i>
            {% endif %}
            {% if p.proposal_impact.level1 %}
                <i class="fa fa-2x fa-check green blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="Provost Approved"></i>
            {% else %}
                <i class="fa fa-2x fa-times red blue-tooltip"
                data-toggle="tooltip" data-placement="top" aria-hidden="true"
                title="Provost has NOT approved Part B"></i>
            {% endif %}
          </td>
          {% else %}
          <td colspan="2" class="red" style="text-align:center;">
            Proposal Declined
          </td>
          {% endif %}
          <td>
            {% ifusergroup osp_group %}
            <a href="{% url 'email_investigator_form' p.id 'compose' %}"
              data-toggle="tooltip" data-placement="top" class="blue-tooltip"
              title="Send email to primary investigator">
              {{p.user.last_name}}, {{p.user.first_name}}
            </a>
            {% else %}
            {{p.user.last_name}}, {{p.user.first_name}}
            {% endifusergroup %}
          </td>
          <td>{{p.grant_deadline_date}}</td>
        </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th>
          Title
          <i class="fa fa-eye green blue-tooltip" data-toggle="tooltip"
            data-placement="top" aria-hidden="true"
            title="View Proposal"></i>
          /
          <i class="fa fa-print green blue-tooltip" data-toggle="tooltip"
            data-placement="top" aria-hidden="true"
            title="Print Proposal"></i></a>
        </th>
        <th>Part A</th>
        <th>Part B</th>
        <th>
          Submitted by
          {% ifusergroup osp_group %}
          <i class="fa fa-envelope-o green blue-tooltip" data-toggle="tooltip"
            data-placement="top" aria-hidden="true"
            title="Send email to primary investigator"></i>
          {% endifusergroup %}
        </th>
        <th>Deadline Date</th>
      </tr>
    </tfoot>
  </table>
</div>
<!-- /.table-responsive -->
